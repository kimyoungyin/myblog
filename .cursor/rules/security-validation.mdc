---
description: 
globs: 
alwaysApply: true
---
# Security & Data Validation (CRITICAL)

## üîí **Data Validation (MUST ENFORCE)**

- **ALWAYS** use Zod schemas for all user input validation
- **NEVER** trust client-side data without server-side validation
- **MUST** validate data in Server Actions before database operations
- **ALWAYS** use the validation schemas from [src/lib/schemas.ts](mdc:src/lib/schemas.ts)

## üõ°Ô∏è **Input Validation Examples**

```typescript
// ‚úÖ CORRECT - Using Zod validation
export const CreatePostSchema = z.object({
    title: z
        .string()
        .min(1, 'Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.')
        .max(100, 'Ï†úÎ™©ÏùÄ 100Í∏ÄÏûê Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.')
        .transform((val) => val.trim()),
    content: z
        .string()
        .min(1, 'ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.')
        .max(50000, 'ÎÇ¥Ïö©ÏùÄ 50,000Í∏ÄÏûê Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.'),
    hashtags: z
        .array(z.string().min(2).max(20))
        .min(1, 'ÏµúÏÜå ÌïòÎÇòÏùò Ìï¥ÏãúÌÉúÍ∑∏Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.')
        .max(10, 'Ìï¥ÏãúÌÉúÍ∑∏Îäî ÏµúÎåÄ 10Í∞úÍπåÏßÄ ÏûÖÎ†•Ìï† Ïàò ÏûàÏäµÎãàÎã§.'),
});

// ‚ùå WRONG - No validation or weak validation
export const createPost = async (data: any) => {
    // Direct database operation without validation
    return await supabase.from('posts').insert(data);
};
```

## üö´ **FORBIDDEN Security Practices**

- **NEVER** use `any` type for user input
- **NEVER** bypass validation for "admin" users
- **NEVER** store sensitive data in client-side state
- **NEVER** use `eval()` or `innerHTML` with user input
- **NEVER** expose database credentials or API keys

## ‚úÖ **REQUIRED Security Practices**

- **ALWAYS** validate all form inputs with Zod schemas
- **ALWAYS** use Server Actions for data mutations
- **ALWAYS** implement proper authentication checks
- **ALWAYS** sanitize user input before rendering
- **ALWAYS** use HTTPS in production
- **ALWAYS** implement rate limiting for API endpoints

## üîê **Authentication & Authorization**

- **ALWAYS** check `is_admin` field for admin operations
- **ALWAYS** validate user sessions on the server side
- **NEVER** rely solely on client-side authentication
- **MUST** implement proper session management with Supabase
  description:
  globs:
  alwaysApply: true

---
